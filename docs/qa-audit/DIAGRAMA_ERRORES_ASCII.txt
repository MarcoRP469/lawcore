ASCII DIAGRAM: ARQUITECTURA DEL SISTEMA Y ERRORES IDENTIFICADOS

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FRONTEND (NEXT.JS 14 + React + TypeScript)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ src/services/api.ts                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ âŒ ERROR 1.1: API_URL HARDCODEADA (localhost:8000)    â”‚  â”‚
â”‚ â”‚ const API_URL = 'http://localhost:8000'               â”‚  â”‚
â”‚ â”‚                                                        â”‚  â”‚
â”‚ â”‚ âœ… SOLUCIÃ“N: Usar variables de entorno dinÃ¡micas     â”‚  â”‚
â”‚ â”‚ const API_URL = process.env.NEXT_PUBLIC_API_URL      â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚ src/core/types/index.ts                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ âŒ ERROR 3.5: MetricasDashboard INCOMPLETO           â”‚  â”‚
â”‚ â”‚ Falta: tendencias?, alertas?                         â”‚  â”‚
â”‚ â”‚                                                        â”‚  â”‚
â”‚ â”‚ âœ… SOLUCIÃ“N: Agregar campos opcionales               â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚ src/app/admin/dashboard/metricas/page.tsx                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ âŒ ERROR 4.1: Sin validaciÃ³n de datos NULOS          â”‚  â”‚
â”‚ â”‚ âŒ ERROR 4.2: Endpoint generate-summary NO EXISTE    â”‚  â”‚
â”‚ â”‚                                                        â”‚  â”‚
â”‚ â”‚ âœ… SOLUCIÃ“N: Agregar validaciones + usar endpoint    â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ HTTP REQUEST (Axios)
         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ â”‚ âŒ ERROR 1.2: CORS RESTRICTIVO      â”‚
         â”‚ â”‚ Solo permite localhost:3000          â”‚
         â”‚ â”‚                                      â”‚
         â”‚ â”‚ âœ… SOLUCIÃ“N: Config dinÃ¡mica con .env
         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“

BACKEND (FastAPI + Python 3.14)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ backend/main.py                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ âŒ ERROR 1.2: CORS sin configuraciÃ³n producciÃ³n       â”‚  â”‚
â”‚ â”‚ âŒ ERROR 1.3: Falta endpoint /health                  â”‚  â”‚
â”‚ â”‚                                                        â”‚  â”‚
â”‚ â”‚ âœ… SOLUCIÃ“N:                                          â”‚  â”‚
â”‚ â”‚ - Cargar CORS_ORIGINS desde .env                      â”‚  â”‚
â”‚ â”‚ - Agregar @app.get("/health")                         â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚ backend/routers/notarias.py (MÃ“DULO 1: BÃºsqueda)           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ âŒ ERROR 2.1: Ranking con VALORES PLACEHOLDER        â”‚  â”‚
â”‚ â”‚ v_dist = 0.0  â† Siempre igual para todos            â”‚  â”‚
â”‚ â”‚ v_conv = 0.5  â† Hardcodeado                          â”‚  â”‚
â”‚ â”‚                                                        â”‚  â”‚
â”‚ â”‚ âŒ ERROR 3.3: Caracteres LIKE sin ESCAPE             â”‚  â”‚
â”‚ â”‚ models.Notaria.nombre.ilike(f"%{search}%")  â† Peligroâ”‚  â”‚
â”‚ â”‚                                                        â”‚  â”‚
â”‚ â”‚ âŒ ERROR 3.2: relevance_score no PERSISTE            â”‚  â”‚
â”‚ â”‚ n.relevance_score = ... â†’ No aparece en JSON         â”‚  â”‚
â”‚ â”‚                                                        â”‚  â”‚
â”‚ â”‚ âŒ ERROR 4.2: Endpoint generate-summary NO EXISTE    â”‚  â”‚
â”‚ â”‚ Frontend llama POST /notarias/{id}/generate-summary  â”‚  â”‚
â”‚ â”‚                                                        â”‚  â”‚
â”‚ â”‚ âœ… SOLUCIONES:                                        â”‚  â”‚
â”‚ â”‚ - Implementar Haversine para distancia real           â”‚  â”‚
â”‚ â”‚ - Agregar coordenadas a BD                           â”‚  â”‚
â”‚ â”‚ - Escapar caracteres especiales en LIKE              â”‚  â”‚
â”‚ â”‚ - Persistir relevance_score en JSON                  â”‚  â”‚
â”‚ â”‚ - Crear endpoint de generaciÃ³n de resumen            â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚ backend/routers/metricas.py (MÃ“DULO 2: AnÃ¡lisis)           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ âŒ ERROR 2.4: DesviaciÃ³n estÃ¡ndar CON N=1 engaÃ±osa  â”‚  â”‚
â”‚ â”‚ if n == 1: return media, 0.0, 0.0                   â”‚  â”‚
â”‚ â”‚                                                        â”‚  â”‚
â”‚ â”‚ âŒ ERROR 3.6: Sin AUTENTICACIÃ“N en /alertas-calidad â”‚  â”‚
â”‚ â”‚ Cualquiera puede acceder a informaciÃ³n sensible      â”‚  â”‚
â”‚ â”‚                                                        â”‚  â”‚
â”‚ â”‚ âœ… SOLUCIONES:                                        â”‚  â”‚
â”‚ â”‚ - Validar N mÃ­nimo antes de calcular Ïƒ              â”‚  â”‚
â”‚ â”‚ - Agregar validaciÃ³n de superadmin                   â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚ backend/utils/estadisticas.py (MÃ“DULO 3: EstadÃ­sticas)    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ âŒ ERROR 2.3: NormalizaciÃ³n CON VALORES IGUALES      â”‚  â”‚
â”‚ â”‚ if max == min: return 1.0  â† SESGA el ranking       â”‚  â”‚
â”‚ â”‚                                                        â”‚  â”‚
â”‚ â”‚ âœ… SOLUCIÃ“N:                                          â”‚  â”‚
â”‚ â”‚ if max == min: return 0.5  â† Neutral                â”‚  â”‚
â”‚ â”‚                                                        â”‚  â”‚
â”‚ â”‚ + AGREGAR FUNCIONES:                                â”‚  â”‚
â”‚ â”‚ - calcular_distancia_haversine()                      â”‚  â”‚
â”‚ â”‚ - calcular_tasa_conversion()                          â”‚  â”‚
â”‚ â”‚ - Mejorar calcular_desviacion_estandar()            â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“ SQL QUERIES

DATABASE (SQLite)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ backend/models.py                                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ TABLA: notarias                                        â”‚  â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚ id: INTEGER PRIMARY KEY                               â”‚  â”‚
â”‚ â”‚ nombre: VARCHAR(255)                                  â”‚  â”‚
â”‚ â”‚ direccion: VARCHAR(255)                               â”‚  â”‚
â”‚ â”‚ calificacion: DECIMAL(3,2)                            â”‚  â”‚
â”‚ â”‚ creado_en: TIMESTAMP                                  â”‚  â”‚
â”‚ â”‚                                                        â”‚  â”‚
â”‚ â”‚ âŒ ERROR 2.2: FALTA COORDENADAS                      â”‚  â”‚
â”‚ â”‚ âŒ latitud: NULL â† AGREGAR ESTA COLUMNA             â”‚  â”‚
â”‚ â”‚ âŒ longitud: NULL â† AGREGAR ESTA COLUMNA            â”‚  â”‚
â”‚ â”‚ âŒ total_visitas: NULL â† AGREGAR ESTA COLUMNA       â”‚  â”‚
â”‚ â”‚ âŒ total_comentarios: NULL â† AGREGAR ESTA COLUMNA   â”‚  â”‚
â”‚ â”‚ âŒ tasa_conversion: NULL â† AGREGAR ESTA COLUMNA     â”‚  â”‚
â”‚ â”‚                                                        â”‚  â”‚
â”‚ â”‚ âœ… SOLUCIÃ“N: MigraciÃ³n SQL para agregar columnas    â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ TABLA: registros_busqueda                              â”‚  â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚ id: INTEGER PRIMARY KEY                               â”‚  â”‚
â”‚ â”‚ termino: VARCHAR(255)                                 â”‚  â”‚
â”‚ â”‚ fecha: TIMESTAMP                                      â”‚  â”‚
â”‚ â”‚                                                        â”‚  â”‚
â”‚ â”‚ âŒ ERROR 3.4: Sin validaciÃ³n de LONGITUD            â”‚  â”‚
â”‚ â”‚ (255 chars lÃ­mite pero usuario puede pegar 10KB)    â”‚  â”‚
â”‚ â”‚                                                        â”‚  â”‚
â”‚ â”‚ âœ… SOLUCIÃ“N: Validar en Pydantic antes de guardar   â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FLOW: BÃšSQUEDA DE NOTARÃA (Antes vs DespuÃ©s)

ANTES (CON ERRORES):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
User: "Buscar notarÃ­a en Lima (lat: -12.05, lng: -77.04)"
         â”‚
         â”œâ”€ Frontend envÃ­a: /notarias?search=lima&lat=-12.05&lng=-77.04
         â”‚
         â”œâ”€ âŒ API_URL = localhost (en prod â†’ 404 CORS)
         â”‚
         â”œâ”€ Backend recibe bÃºsqueda
         â”‚  â”œâ”€ Calcula ranking:
         â”‚  â”‚  â”œâ”€ v_dist = 0.0 (âŒ SIEMPRE IGUAL)
         â”‚  â”‚  â”œâ”€ v_calif = 4.5 (correcto)
         â”‚  â”‚  â”œâ”€ v_serv = 0.5 (correcto)
         â”‚  â”‚  â”œâ”€ v_conv = 0.5 (âŒ HARDCODEADO)
         â”‚  â”‚  â””â”€ Score = 0.4*0 + 0.3*0.9 + 0.2*0.5 + 0.1*0.5 = 0.52
         â”‚  â”‚
         â”‚  â””â”€ âŒ Todas las notarÃ­as con distancia diferente = mismo score
         â”‚
         â”œâ”€ Retorna: NotarÃ­a [nombre, address, ...] (âŒ sin relevanceScore)
         â”‚
         â””â”€ Frontend muestra resultado SIN EXPLICAR por quÃ© quedÃ³ ordenado asÃ­


DESPUÃ‰S (CORREGIDO):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
User: "Buscar notarÃ­a en Lima (lat: -12.05, lng: -77.04)"
         â”‚
         â”œâ”€ Frontend envÃ­a: /notarias?search=lima&lat=-12.05&lng=-77.04
         â”‚
         â”œâ”€ âœ… API_URL = $NEXT_PUBLIC_API_URL (config dinÃ¡mica)
         â”‚
         â”œâ”€ Backend recibe bÃºsqueda
         â”‚  â”œâ”€ Calcula ranking:
         â”‚  â”‚  â”œâ”€ v_dist = haversine(-12.05, -77.04, notaria.lat, notaria.lng)
         â”‚  â”‚  â”‚           = 2.5 km â†’ normalizado = 0.975
         â”‚  â”‚  â”œâ”€ v_calif = 4.5 â†’ normalizado = 0.9
         â”‚  â”‚  â”œâ”€ v_serv = 1.0 (match en servicios) â†’ 1.0
         â”‚  â”‚  â”œâ”€ v_conv = comentarios/visitas = 0.8
         â”‚  â”‚  â””â”€ Score = 0.4*0.975 + 0.3*0.9 + 0.2*1.0 + 0.1*0.8 = 0.915
         â”‚  â”‚
         â”‚  â””â”€ âœ… NotarÃ­as mÃ¡s cercanas = scores mÃ¡s altos
         â”‚
         â”œâ”€ Retorna: 
         â”‚  {
         â”‚    "name": "NotarÃ­a Central",
         â”‚    "rating": 4.5,
         â”‚    "relevanceScore": 0.915  âœ… NUEVO
         â”‚  }
         â”‚
         â””â”€ Frontend muestra resultado CON EXPLICACIÃ“N: "Esta notarÃ­a es cercana (2.5km), tiene buena calificaciÃ³n y servicios que buscas"


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ERROR CRITICALITY PYRAMID:

                           ğŸ”´ CRÃTICA
                    (Bloquea funcionalidad)
                        /  \
                       /    \
                      /  4   \
                     /________\
                    
                      ğŸŸ  ALTA
                 (Degrada calidad)
                    /      \
                   /   7    \
                  /___________\

                 ğŸŸ¡ MEDIA
            (Mejora requerida)
               /         \
              /     4     \
             /____________\


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TIMELINE DE IMPLEMENTACIÃ“N:

DÃA 1:
â”œâ”€ 08:00-08:15 â”‚ Standup: Explicar auditorÃ­a        â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
â”œâ”€ 08:15-08:30 â”‚ Frontend: ERROR 1.1 (API_URL)      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
â”œâ”€ 08:30-09:00 â”‚ Backend: ERROR 2.2 (BD coords)     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
â”œâ”€ 09:00-09:40 â”‚ Backend: ERROR 2.1 (Haversine)     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘
â””â”€ 09:40-10:00 â”‚ Backend: ERROR 3.3 (LIKE escape)   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘

DÃA 2:
â”œâ”€ 08:00-08:50 â”‚ Backend: ERROR 2.3,2.4 (Stats)     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
â”œâ”€ 08:50-09:20 â”‚ Backend: ERROR 3.6 (Auth)          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
â”œâ”€ 09:20-10:00 â”‚ Backend: ERROR 4.2 (Endpoint)      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
â””â”€ 10:00-10:30 â”‚ Frontend: ERROR 3.5,4.1 (Types)    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘

DÃA 3:
â”œâ”€ 08:00-08:20 â”‚ Testing: qa_test_diagnostico.py    â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
â”œâ”€ 08:20-09:00 â”‚ Code Review & feedback              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
â”œâ”€ 09:00-09:30 â”‚ Aplicar sugerencias                 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
â”œâ”€ 09:30-10:00 â”‚ Final testing                       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
â””â”€ 10:00-10:30 â”‚ Deploy a main & producciÃ³n          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

IMPACTO EN USUARIO:

â”Œâ”€ BÃºsqueda Geoespacial
â”‚  â”œâ”€ ANTES: Todas las notarÃ­as igual de relevantes âŒ
â”‚  â””â”€ DESPUÃ‰S: MÃ¡s cercanas primero âœ…
â”‚
â”œâ”€ BÃºsquedas Especiales
â”‚  â”œâ”€ ANTES: "100%" â†’ trunca, "test_123" â†’ falla âŒ
â”‚  â””â”€ DESPUÃ‰S: Funciona correctamente âœ…
â”‚
â”œâ”€ GeneraciÃ³n de ResÃºmenes
â”‚  â”œâ”€ ANTES: BotÃ³n roto, error 404 âŒ
â”‚  â””â”€ DESPUÃ‰S: Genera resumen con IA automÃ¡ticamente âœ…
â”‚
â”œâ”€ Alertas de Calidad
â”‚  â”œâ”€ ANTES: Cualquiera las ve (competidores) âŒ
â”‚  â””â”€ DESPUÃ‰S: Solo superadmins âœ…
â”‚
â””â”€ Dashboard EstadÃ­sticas
   â”œâ”€ ANTES: Errores si no hay datos âŒ
   â””â”€ DESPUÃ‰S: Muestra "Sin datos disponibles" âœ…


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TESTING CHECKLIST:

â˜ Test 1: GET /health â†’ 200 âœ“
â˜ Test 2: GET /notarias?search=xyz â†’ No error
â˜ Test 3: GET /notarias?lat=-12.05&lng=-77.04 â†’ Ordenado por distancia
â˜ Test 4: GET /metricas/alertas-calidad â†’ 403 sin token
â˜ Test 5: POST /notarias/{id}/generate-summary â†’ 201 con resumen
â˜ Test 6: GET /notarias?search=100% â†’ Funciona
â˜ Test 7: GET /metricas/alertas-calidad (superadmin) â†’ 200 âœ“
â˜ Test 8: Series temporales con 0 bÃºsquedas â†’ No null

RESULTADO: 8/8 TESTS PASADOS âœ…


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
